

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
	aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header dialog-title">
				<h5 class="modal-title" id="exampleModalLabel">趋势图查看</h5>
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close" onclick="closeGraph();">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="content-wrapper" style="display: none;">
				<div class="row">
					<div class="col-12">
						<div class="card">
							<div class="card-body">
								<div class="row">
									<div class="col-12">
										<div class="row portfolio-grid" id="ui-historyDataPoints">
											<div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-12"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-lg-12 grid-margin stretch-card">
				<div class="card">
					<div class="card-body">
						<div class="col-md-12 mb-4 mt-4">
							<div class="btn-toolbar">
								<div class="btn-group">
									<div class='input-group date form_date col-md-6'>
										<input name="startTm" id="datetimepicker_start_graph"
											type='text' placeholder="开始时间" class="form-control input-sm"
											readonly="readonly" /> <span
											class="input-group-addon input-sm"> <span
											class="glyphicon glyphicon-calendar"></span></span>
									</div>
									<div class='input-group date form_date col-md-6'>
										<input name="startTm" id="datetimepicker_end_graph"
											type='text' placeholder="结束时间" class="form-control input-sm"
											readonly="readonly" /> <span
											class="input-group-addon input-sm"> <span
											class="glyphicon glyphicon-calendar"></span></span>
									</div>
									<div class="btn-toolbar">
										<button type="button" class="btn btn-sm btn-outline-secondary"
											onclick="_search();">
											<i class="mdi mdi-search-web text-primary"></i> 查询
										</button>
									</div>
									<script type="text/javascript">
										var _startTime_;
										var _endTime_;

										$('#datetimepicker_start_graph')
												.datetimepicker(
														{//初始化
															language : 'zh-CN',
															//weekStart: 1,
															//todayBtn:  1,
															autoclose : 1,
															step : 10,
															//todayHighlight: 1,
															//startView: 2,
															//minView: 2,
															//forceParse: 0,
															//format: 'mm-dd hh:MM:ss',//格式化想要显示的时间格式
															minView : 'month',//日期时间选择器所能够提供的最精确的时间选择视图。
															onSelectTime : function(
																	dateText,
																	inst) {
																_startTime_ = new Date(
																		dateText)
																		.getTime();
															}
														});
										$('#datetimepicker_end_graph')
												.datetimepicker(
														{//初始化
															language : 'zh-CN',
															//weekStart: 1,
															//todayBtn:  1,
															autoclose : 1,
															//todayHighlight: 1,
															//startView: 2,
															//minView: 2,
															//forceParse: 0,
															//format: 'yyyy-mm-dd',//格式化想要显示的时间格式
															minView : 'month',//日期时间选择器所能够提供的最精确的时间选择视图。
															onSelectTime : function(
																	dateText,
																	inst) {
																_endTime_ = new Date(
																		dateText)
																		.getTime();
															}
														});
									</script>
								</div>
							</div>
							<div class="col-md-12 mb-4 mt-4">
								<div class="btn-group">
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="_backward();">
										<i class="mdi mdi-step-backward text-primary"></i> 后退
									</button>
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="play();">
										<i class="mdi mdi-play text-primary"></i>播放
									</button>
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="_forward();">
										<i class="mdi mdi-step-forward text-primary"></i>前进
									</button>
								</div>
								<div class="btn-group">
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="zoomin_x();">
										<i class="mdi mdi-format-superscript text-primary"></i>x轴放大
									</button>
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="zoomout_x();">
										<i class="mdi mdi-format-subscript text-primary"></i>x轴缩小
									</button>
								</div>
								<div class="btn-group">
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="zoomin_y();">
										<i class="mdi mdi-arrow-expand-up text-primary"></i>y轴放大
									</button>
									<button type="button" class="btn btn-sm btn-outline-secondary"
										onclick="zoomout_y();">
										<i class="mdi mdi-arrow-expand-down text-primary"></i>y轴缩小
									</button>
								</div>
							</div>
						</div>
					</div>
					<div class="card-body" style="overflow: auto">
						<table class="table table-bordered"
							style="white-space: nowrap; overflow-y: scroll; overflow-x: scroll;"
							id="_datatableUI">
						</table>
					</div>
					<div class="card-body">
						<div id="ui-historyDataLineChart">
							<div id="c3-line-chart"></div>
							<div id="c3-spline-chart"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<div style="position: fixed; top: 250px; right: 10px; z-index: 900;">
	<div style="opacity:0.5;" class="modal-footer">
		<button class="btn btn-sm btn-outline-secondary" onclick="switchVisuale();">
			<i class="mdi mdi-fullscreen ml-1"></i>
		</button>
	</div>
	<div id="graphPannel" class="modal-footer dialog-title"
		style="float: right;">
		<div class="card ">
			<div class="accordion accordion-inverse-primary" id="accordion-2"
				role="tablist">
				<div class="card col-12">
					<div class="box">
						<span class="pillar"></span>
						<div class="wrapper" id="wrapper1">
							<div class="scroller">
								<ul class="clearfix">
									<li><span><i>0.4</i></span></li>
									<li><span><i>0.5</i></span></li>
									<li><span><i>0.6</i></span></li>
									<li><span><i>0.7</i></span></li>
									<li><span><i>0.8</i></span></li>
									<li><span><i>0.9</i></span></li>
									<li><span><i>1.0</i></span></li>
									<li><span><i>1.1</i></span></li>
									<li><span><i>1.2</i></span></li>
									<li><span><i>1.3</i></span></li>
									<li><span><i>1.4</i></span></li>
									<li><span><i>1.5</i></span></li>
									<li><span><i>1.6</i></span></li>
									<li><span><i>1.7</i></span></li>
									<li><span><i>1.8</i></span></li>
								</ul>
							</div>
						</div>
					</div>


					<div>
						<!-- 
						<button id="zoom_in">
							<i class="mdi mdi-plus-circle-outline ml-1"></i>
						</button>
						<button id="zoom_out">
							<i class="mdi mdi-minus-circle-outline ml-1"></i>
						</button>
					 -->
					</div>
					<div>
						<button class="btn btn-sm btn-outline-secondary" id="zoom_up">
							<i class="mdi mdi-arrow-up ml-1"></i>
						</button>
						<button class="btn btn-sm btn-outline-secondary" id="zoom_down">
							<i class="mdi mdi-arrow-down ml-1"></i>
						</button>
						<button class="btn btn-sm btn-outline-secondary" id="zoom_left">
							<i class="mdi mdi-arrow-left ml-1"></i>
						</button>
						<button class="btn btn-sm btn-outline-secondary" id="zoom_right">
							<i class="mdi mdi-arrow-right ml-1"></i>
						</button>
						<button class="btn btn-sm btn-outline-secondary" id="zoom_fullScreen">
							<i class="mdi mdi-fullscreen ml-1"></i>
						</button>
					</div>
					<div class="card-header" role="tab" id="headingOne-2">
						<h6 class="mb-0">
							<a data-toggle="collapse" href="#collapseOne-2"
								aria-expanded="true" aria-controls="collapseOne-2"> 点位</a>
						</h6>
					</div>
					<div id="collapseOne-2" class="collapse show" role="tabpanel"
						aria-labelledby="headingOne-2" data-parent="#accordion-2">
						<div class="card-body">
							<div class="list-wrapper">
								<ul
									class="d-flex flex-column-reverse todo-list todo-list-custom"
									id="xygraph_points_ui">
								</ul>
							</div>
						</div>
					</div>
					<button type="button" class="btn btn-primary btn-sm"
						onclick="buildChart()">
						查看趋势图<i class="mdi mdi-play-circle ml-1"></i>
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- partial -->
<div id="_diagramShow"></div>

<!-- Dummy Modal Ends -->

<script>
	var graphPannelVisual = true;
	function switchVisuale() {
		var graphPannel = document.getElementById("graphPannel");
		graphPannelVisual = !graphPannelVisual;
		if (graphPannelVisual)
			graphPannel.style.display = "";
		else
			graphPannel.style.display = "none";

	}
	function getGraphByPath_1(graph, path) {
		if (path == null || path == "undefined")
			return graph;
		//console.log("graph.wholePath="+graph.wholePath.toLowerCase()+"  ==  "+"path="+path.toLowerCase());
		if (graph.wholePath.toLowerCase().indexOf(path.toLowerCase()) != -1) {
			//console.log("找到了");
			_graphId = graph.id;
			return graph;
		} else {
			console.log(graph.wholePath.toLowerCase() + " 3");
			var children = graph.children;
			if (children != null) {
				var keys = new Array();
				Object.keys(children).forEach(function(key) {
					//console.log("4"+key);
					keys.push(key);
					children[key]
				});
				for (var i = 0; i < keys.length; i++) {
					var child = children[keys[i]];
					var t = getGraphByPath_1(child, path);
					if (t != null)
						return t;
				}
			}
			return null;
		}
	}

	if (userSpace == null | userSpace == "undefined") {
		getUserSpace(uid, token, graphSubscribe);
	} else {
		if (_graphId == null || _graphId == "undefined") {
			//console.log(" graph.js -> graphSubscribe() -> getGraphByURLPath(graph,_diagramShowKey="+_diagramShowKey+")");
			var g = getGraphByPath_1(userSpace.graph, _diagramShowKey);
			if (g == null || g == "undefined" || g.id == null
					|| g.id == "undefined") {
				alert("您没有查看这个图形的权限。");
			} else {
				_graphId = g.id;
				_diagramShowKey = g.urlPath;
				$("#_diagramShow").load(_diagramShowKey, null, changeAAction);
			}
		} else {
			$("#_diagramShow").load(_diagramShowKey, null, changeAAction);
		}
		console.log("dddd");
	}

	// 页面加载完成后调用。在之前调用会导致不能正确获得对象。
	function changeAAction() {
		console.log("=====================");
		var d = document.getElementById("_diagramShow");
		//	  console.log("html:"+d.innerHTML);
		var as = d.getElementsByTagName("a");
		for (var i = 0; i < as.length; i++) {
			var _a = as[i];
			//console.log("a - html: "+_a.outerHTML+" url="+_a.href.baseVal);
			var t = _a.href.baseVal;

			_a.onclick = function() {
				//console.log("点击了 "+this.innerHTML);
				console.log("a -  url=" + this.href.baseVal);
				var g = getGraphByPath_1(userSpace.graph, this.href.baseVal);
				if (g == null || g == "undefined" || g.id == null
						|| g.id == "undefined") {
					alert("您没有查看这个图形的权限。");
				} else {
					_graphId = g.id;
					_diagramShowKey = g.urlPath;
					routeTo("diagramDetail", this.href.baseVal);
				}

				return false;
			};
		}

		// 获取图形宽高
		svg1 = document.getElementsByTagName("svg");
		svg1 = svg1[0];
		width = svg1.attributes.width.value;
		height = svg1.attributes.height.value;
		//width = 960;
		//height = 500;
		console.log("widthaaa=" + width + " heightbbb=" + height + "");
		// D3操作对象
		zoom = d3.behavior.zoom().scaleExtent([ 0.5, 8 ]).on("zoom", null); //= d3.zoom().scaleExtent([1, 8]).on("zoom", zoomed);
		svg = d3.select("svg").call(zoom);
		drag = d3.behavior.drag().origin(function() {
			var t = d3.select(this);
			return {
				x : t.attr("cx"),
				y : t.attr("cy")
			};
		}).on("drag", draged);
		drag.on("dragstart", function() {
			d3.event.sourceEvent.stopPropagation(); // silence other listeners
		});
		svg = d3.select("svg").call(drag);//.call(zoom);
		fullScreen();
		function draged(d) {
			console.log("draged. scale=" + scale);
			zoom.translate(translate);
			d3.select(this).attr("cx", d3.event.x).attr("cy", d3.event.y);
			//console.log("draged 1 . "+this);
			var trans = [ d3.event.x, d3.event.y ];
			translate = trans;
			zoomed();

		}

		// 图形全屏
		fullScreen();

		var diff = Math.round(((scale - 1) * 1000 + 600) / 100);
		//console.log("scale=" + scale + " diff=" + diff);
		$(function() {
			$('#wrapper1').navbarscroll({
				defaultSelect : diff,
				duibiScreenWidth : 0.1, //单位以rem为准，默认为0.4rem
				scrollerWidth : 1, //单位以px为准，默认为3,[仅用于特殊情况：外层宽度因为小数点造成的不精准情况]
				fingerClick : 0, //目标第0或1个选项触发,必须每一项长度一致，方可用此项
				endClickScroll : function(obj) {
					console.log("obj.text() = " + obj.text())
				}
			});
		});
		fullScreen();

	}
	var number1 = 0;
	function shownumber1() {
		console.log("number = " + number1);
		scale = 1 + (number1 - 600) / 1000;
		interpolateZoom(translate, scale);
		// svg.attr("transform", "translate(" + [ 0, 0 ] + ")" + "scale(" + scale+ ")");
	}
	function scrollTo(lab) {
		//console.log("lab=" + lab);
		if (lab == null || lab == "undefined") {
			//lab = scale;
			lab = Math.round(((scale - 1) * 1000 + 600) / 100);
		}
		$('#wrapper1').navbarscroll({
			defaultSelect : lab,
			duibiScreenWidth : 0.1, //单位以rem为准，默认为0.4rem
			scrollerWidth : 1, //单位以px为准，默认为3,[仅用于特殊情况：外层宽度因为小数点造成的不精准情况]
			fingerClick : 0, //目标第0或1个选项触发,必须每一项长度一致，方可用此项
			endClickScroll : function(obj) {
				//console.log("obj.text() = " + obj.text())
			}
		});
	}

	var svg1;
	var svg;//svg = document.getElementsByTagName("svg");
	console.log("=====1");
	var width = 0;//svg.attributes.width.value;
	var height = 0;//svg.attributes.height.value;

	// 上面在加载后，还有一句设置，应该是那里设置才最合理。
	// 结果我在这里也设置了，加载后的设置值把这个给替换了。
	// 调试了4个小时才找到，这里值得记录一下。
	var zoom;//= d3.behavior.zoom().scaleExtent([0.1, 8]).on("zoom", zoomed);

	function zoomed() {
		// console.log("zoomed() zoom.translate()="+zoom.translate()+" zoom.scale()="+zoom.scale());

		svg.attr("transform", "translate(" + translate + ")" +
		//"translate(0,0)" +
		"scale(" + scale + ")");
		//scrollTo();
		// 计算scale，调整值
		// svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
	}

	function interpolateZoom(_translate, _scale) {
		scale = _scale;
		translate = _translate;
		zoomed();
	}

	function zoomClick() {
		switch (this.id) {
		case 'zoom_up':
			translate = [ translate[0], translate[1] - 10 ];
			zoomed();
			return;
		case 'zoom_down':
			translate = [ translate[0], translate[1] + 10 ];
			zoomed();
			return;
		case 'zoom_left':
			translate = [ translate[0] - 10, translate[1] ];
			zoomed();
			return;
		case 'zoom_right':
			translate = [ translate[0] + 10, translate[1] ];
			zoomed();
			return;
		case 'zoom_fullScreen':
			fullScreen();
			return;
		case 'zoom_in':
			direction = 1;
			break;
		case 'zoom_out':
			direction = -1;
			break;
		default:
			return;
		}

	}

	var scale;
	var translate;
	var fullScreenEnable = true;
	function fullScreen() {
		console.log("fullScreen()");
		if (!fullScreenEnable)
			fullScreenEnable = !fullScreenEnable;
		fullScreenFn();
		fullScreenFn();
	}

	function fullScreenFn() {
		if (fullScreenEnable) {
			// 取当前页面宽度和高度
			var _topToolsBar = document.getElementById("topToolsBar");
			var topToolsBarRect = _topToolsBar.getBoundingClientRect();
			var _svgP = document.getElementById("mainPanel");//svg1.parentNode;
			var mainToolsBarRect = _svgP.getBoundingClientRect();
			//console.log(" y="+JSON.stringify(mainToolsBar.getBoundingClientRect()));
			// 取当前图形宽度和高度 
			//console.log(" width=" + width + " heigth=" + height);
			// mainPanel屏幕左上角坐标
			var y = mainToolsBarRect.y;//+ mainToolsBarRect.height;
			var x = mainToolsBarRect.x;
			var mainPanelHeight = window.innerHeight - topToolsBarRect.height;
			var mainPanelWidth = mainToolsBarRect.width;

			var scale1 = mainPanelHeight / mainPanelWidth;
			//var _diagramShow = document.getElementById("_diagramShow").getBoundingClientRect();
			//var scale2 = _diagramShow.height / _diagramShow.width;
			//var scale2 = svg.attr("height") / svg.attr("width");
			var scale2 = height / width;
			//var scale ;//= scale1 > scale2 ? scale1 : scale2;
			//if (scale1 > scale2) { // 图比屏幕扁，以图的宽为限
			//	scale = mainPanelWidth / svg.attr("width");
			//} else {
			//	scale = mainPanelHeigth / svg.attr("height");
			//}
			if (scale1 > scale2) { // 图比屏幕扁，以图的宽为限
				scale = mainPanelWidth / width;
			} else {
				scale = mainPanelHeight / height;
			}

			var svgx = svg1.getBoundingClientRect().x;
			var svgy = svg1.getBoundingClientRect().y;
			console
					.log("------------------------------------------------------");
			console.log("svg ->  " + svg.attr("width") + " - "
					+ svg.attr("height"));
			console.log("svg ->  "
					+ JSON.stringify(svg1.getBoundingClientRect()));
			console.log("mainPanelHeight()=" + mainPanelHeight
					+ " mainPanelWidth=" + mainPanelWidth
					+ " mainToolsBarRect.x=" + mainToolsBarRect.x
					+ " mainToolsBarRect.y=" + mainToolsBarRect.y);

			// 计算translate和scale,调用 function interpolateZoom (translate, scale)
			//var tx = _diagramShow.x + _diagramShow.width / 2 * (1 - scale);
			//var ty = _diagramShow.y + _diagramShow.height / 2 * (1 - scale);
			var tx = svg.attr("width") / 2 * (1 - scale);
			var ty = svg.attr("height") / 2 * (1 - scale);
			//var trans = {_diagramShow.x - x,_diagramShow.y - y};
			if (translate == null || translate == "undefined")
				translate = zoom.translate();

			console.log("translate=" + translate);
			console.log("scale=" + scale + " tx=" + tx + " ty=" + ty + " x="
					+ x + " svgx=" + svgx + " y=" + y + " svgy=" + svgy
					+ " x-ty=" + (x - tx) + " y-ty=" + (y - ty));
			var _ttx = mainToolsBarRect.x - svgx + translate[0];//+ svg.attr("width") / 2 * (1 - scale);
			var _tty = mainToolsBarRect.y - svgy + translate[1];//+ svg.attr("height") / 2 * (1 - scale);
			console.log("_ttx=" + _ttx + " _tty=" + _tty);
			console.log("translate=" + translate);
			

			interpolateZoom([ _ttx, _tty ], scale);
			

			svg.attr("preserveAspectRatio","none");
			//svg.attr("preserveAspectRatio","xMin YMin meet");
			//svg.attr("width",mainPanelWidth/scale);
			//svg.attr("heigth",mainPanelHeight/scale);
			console.log(" -"+svg1.getBBox().width+" "+svg1.getBBox().height);
			console.log("width="+width+"  height="+height+" scale*width="+scale*width);
			//svg1.setAttribute("viewBox",0+" "+0+" "+mainPanelWidth+" "+mainPanelHeight);
			svg1.removeAttribute("width");
			svg1.removeAttribute("heigth");
			svg1.setAttribute("width",mainPanelWidth/scale);
			svg1.setAttribute("heigth",mainPanelHeight/scale);
			//svg1.parentNode.setAttribute("heigth",1080);
			//	svg.attr("transform",
			//	        "translate(" + [_ttx, _tty] + ")" +
			//	        "scale(" + scale + ")"
			//	    );

			
			svgx = svg1.getBoundingClientRect().x;
			svgy = svg1.getBoundingClientRect().y;
			console.log(zoom.translate());
			console.log("svg ->  " + svg.attr("width") + " - "
					+ svg.attr("height"));
			console.log("svg ->  "
					+ JSON.stringify(svg1.getBoundingClientRect()));
			console.log("mainPanelHeight()=" + mainPanelHeight
					+ " mainPanelWidth=" + mainPanelWidth
					+ " mainToolsBarRect.x=" + mainToolsBarRect.x
					+ " mainToolsBarRect.y=" + mainToolsBarRect.y);
			console.log("translate=" + translate);
			console
					.log("------------------------------------------------------");
		}
	}

	function adjustToFreezeWidth(rootSvg) {
	    var windowWidth = $(window).width();
	 
	    var viewBoxVal = rootSvg.getAttribute("viewBox");
	    var viewBoxWidth = viewBoxVal.split(",")[2];
	    var viewBoxHeight = viewBoxVal.split(",")[3];
	    rootSvg.removeAttribute("width");
	    rootSvg.removeAttribute("height");
	 
	    var setWidth = windowWidth;
	    var setHeight = (setWidth * viewBoxHeight) / viewBoxWidth;
	    rootSvg.setAttribute("width", setWidth);
	    rootSvg.setAttribute("height", setHeight);
	}
	 
	function adjustToNone(rootSvg) {
	 
	    var viewBoxVal = rootSvg.getAttribute("viewBox");
	    var viewBoxWidth = viewBoxVal.split(",")[2];
	    var viewBoxHeight = viewBoxVal.split(",")[3];
	    rootSvg.removeAttribute("width");
	    rootSvg.removeAttribute("height");
	 
	    rootSvg.setAttribute("width", viewBoxWidth);
	    rootSvg.setAttribute("height", viewBoxHeight);
	 
	}
	 
	function adjustToFreezeHeight(rootSvg) {
	 
	    var windowHeight = $(window).height();
	 
	    var viewBoxVal = rootSvg.getAttribute("viewBox");
	    var viewBoxWidth = viewBoxVal.split(",")[2];
	    var viewBoxHeight = viewBoxVal.split(",")[3];
	    rootSvg.removeAttribute("width");
	    rootSvg.removeAttribute("height");
	 
	    var setHeight = windowHeight;
	    var setWidth = (setHeight * viewBoxWidth)/viewBoxHeight;
	    rootSvg.setAttribute("width", setWidth);
	    rootSvg.setAttribute("height", setHeight);
	}
	 
	function adjustToFreezeAll() {
	 
	    var windowHeight = $(window).height();
	    var windowWidth = $(window).width();
	    
	    rootSvg.removeAttribute("width");
	    rootSvg.removeAttribute("height");
	 
	    rootSvg.setAttribute("width", windowWidth);
	    rootSvg.setAttribute("height", windowHeight);
	 
	}

	$(window).resize(function() {
		fullScreen();
	});

	// 设置resize事件
	addResizeEvent(fullScreenFn);
	function addResizeEvent(func) {
		//把现有的 window.onload 事件处理函数的值存入变量
		var oldResize = window.resize;
		if (typeof window.resize != "function") {
			//如果这个处理函数还没有绑定任何函数，就像平时那样添加新函数
			window.onload = func;
		} else {
			//如果处理函数已经绑定了一些函数，就把新函数添加到末尾
			window.resize = function() {
				oldResize();
				func();
			}
		}
	}

	d3.selectAll('button').on('click', zoomClick);

	//********************* 对话框拖拽 ********
	var mouseX = 0;
	var mouseY = 0;
	var Dragging = function(validateHandler) { //参数为验证点击区域是否为可移动区域，如果是返回欲移动元素，负责返回null
		var draggingObj = null; //dragging Dialog
		var diffX = 0;
		var diffY = 0;

		function mouseHandler(e) {
			switch (e.type) {
			case 'mousedown':
				console.log("mousedown");
				draggingObj = validateHandler(e);//验证是否为可点击移动区域
				if (draggingObj != null) {
					diffX = e.clientX - draggingObj.offsetLeft;
					diffY = e.clientY - draggingObj.offsetTop;
				}
				break;

			case 'mousemove':
				//console.log("e.clientX="+e.clientX+" e.clientY="+e.clientY);
				mouseX = e.clientX;
				mouseY = e.clientY;
				if (draggingObj) {
					draggingObj.style.left = (e.clientX - diffX) + 'px';
					draggingObj.style.top = (e.clientY - diffY) + 'px';
					if (draggingObj.nodeName == "svg")
						console.log(" x,y => " + e.clientX + " " + e.clientY);
				}

				break;

			case 'mouseup':
				draggingObj = null;
				diffX = 0;
				diffY = 0;
				break;
			}
		}
		;

		return {
			enable : function() {
				document.addEventListener('mousedown', mouseHandler);
				document.addEventListener('mousemove', mouseHandler);
				document.addEventListener('mouseup', mouseHandler);
			},
			disable : function() {
				document.removeEventListener('mousedown', mouseHandler);
				document.removeEventListener('mousemove', mouseHandler);
				document.removeEventListener('mouseup', mouseHandler);
			}
		}
	}

	function getDraggingDialog(e) {
		var target = e.target;
		console.log(" 1 ->" + target);
		console.log(" 2 ->" + target.nodeName);
		console.log(" 3 ->" + target.nodeType + " " + target);
		console.log(" 4 ->" + target.getAttribute("id"));
		if (target.nodeName != "DIV")
			return;
		while (target
				&& (target.className.indexOf('dialog-title') == -1
						|| target.getAttribute("id") != "toMenu" || target.nodeName != "svg")) {
			target = target.offsetParent;
		}
		if (target != null && target.nodeName == "svg")
			return target;
		else if (target != null) {
			return target.offsetParent;
		} else {
			return null;
		}
	}

	Dragging(getDraggingDialog).enable();

	function _addPointToXY(tagName) {
		var pointsul = document.getElementById("xygraph_points_ui");
		var pointli = document.createElement("li");
		pointli.setAttribute("id", "pointli_" + tagName);
		var lihtml = "";
		lihtml += '<div class="form-check form-check-flat"><label class="form-check-label">';
		lihtml += ' <input class="checkbox" type="checkbox">' + tagName;
		lihtml += '</label></div> ';
		lihtml += '<i class="remove mdi mdi-close-circle-outline" onclick="_removePointFromXY(\''
				+ tagName + '\')"></i>';
		pointli.innerHTML = lihtml;
		pointsul.appendChild(pointli);

		//addPointToXYGraph(tagName);
	}
	function _removePointFromXY(tagName) {
		var pointsul = document.getElementById("pointli_" + tagName);
		pointsul.parentNode.removeChild(pointsul);
		removePointFromXYGraph(tagName);
	}
</script>

<!-- End custom js for this page-->
<script src="./js/jquerySession.js"></script>
<script src="js/bootstrap-datetimepicker.min.js"></script>

<!-- 
<script src="./js/light-gallery.js"></script>
<script src="./js/xyRealTimeHistoryGraphChart.js"></script>
<script src="vendors/lightgallery/js/lightgallery-all.min.js"></script>
-->

<script src="./js/graph.js"></script>
<script type="text/javascript" src="js/iscroll.js"></script>
<script type="text/javascript" src="js/navbarscroll.js"></script>


<style>
.overlay {
	fill: none;
	pointer-events: all;
}

button {
	padding: 10px 20px;
}

* {
	padding: 0;
	margin: 0;
}

a {
	text-decoration: none;
}

ul, ol {
	list-style: none;
}

.box {
	height: 30px;
	position: relative;
	width: 85%;
	margin: 3, 0, 3, 0;
}

.wrap {
	min-width: 320px;
	max-width: 768px;
	margin: 0 auto;
	overflow: hidden;
	position: relative;
}

.wrapper {
	position: relative;
	height: 30px;
	line-height: 30px;
	width: 100%;
	overflow: hidden;
	margin: 0 auto;
	border: 1px solid #ccc;
	border-radius: 25px;
}

.wrapper .scroller {
	position: absolute;
	padding: 0 48% 0 50%;
}

.wrapper .scroller li {
	float: left;
	width: 50px;
	height: 13px;
	line-height: 13px;
	text-align: center;
	font-style: none;
	margin: 0 20px;
	padding: 30px 0 10px;
	position: relative;
}
/*	.wrapper .scroller li:first-child {width:230px;}
	.wrapper .scroller li:last-child {width:210px;}*/
.wrapper .scroller li span {
	display: block;
	border-left: 1px solid #ccc; /*border-right:1px solid #ccc;*/
	width: 100%;
	height: 100%;
}

.wrapper .scroller li span i {
	display: inline-block;
	font-size: 12px;
	font-style: normal;
	position: absolute;
	top: 7px;
	left: -10px;
}

.pillar {
	display: inline-block;
	width: 6px;
	height: 100%;
	border-radius: 10px;
	background: red;
	position: absolute;
	z-index: 2;
	left: 50%;
	margin-left: -3px;
}

h3 {
	text-align: center;
	line-height: 60px
}
</style>
